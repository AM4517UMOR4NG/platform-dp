<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Storybook</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 1024px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
        }

        .header {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .navigation {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .nav-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .nav-btn:hover, .nav-btn.active {
            background: white;
            color: #667eea;
            transform: translateY(-2px);
        }

        .main-content {
            padding: 20px;
        }

        .story-section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .story-section.active {
            display: block;
        }

        .storybook {
            background: linear-gradient(45deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .story-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .story-title {
            font-size: 2.2em;
            color: #333;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .story-illustration {
            width: 300px;
            height: 200px;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 15px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .story-illustration::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        .story-text {
            font-size: 1.4em;
            line-height: 1.8;
            color: #444;
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255,255,255,0.7);
            border-radius: 15px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }

        .audio-controls {
            text-align: center;
            margin: 20px 0;
        }

        .audio-btn {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .audio-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .audio-btn:active {
            transform: translateY(0);
        }

        .interactive-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            color: white;
        }

        .drag-drop-area {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 2px dashed rgba(255,255,255,0.5);
        }

        .sentence-template {
            font-size: 1.5em;
            line-height: 2;
            text-align: center;
            margin-bottom: 25px;
        }

        .word-blank {
            display: inline-block;
            width: 120px;
            height: 40px;
            background: rgba(255,255,255,0.8);
            border: 2px dashed #333;
            border-radius: 8px;
            margin: 0 5px;
            vertical-align: middle;
            position: relative;
            color: #333;
            text-align: center;
            line-height: 36px;
            font-weight: bold;
        }

        .word-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .draggable-word {
            background: linear-gradient(45deg, #feca57, #ff9ff3);
            color: #333;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: grab;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            user-select: none;
        }

        .draggable-word:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .draggable-word.dragging {
            transform: rotate(5deg);
            opacity: 0.8;
        }

        .mini-game {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            color: white;
            text-align: center;
        }

        .game-title {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .picture-matching {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .picture-card {
            aspect-ratio: 1;
            background: white;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: #333;
        }

        .picture-card:hover {
            transform: scale(1.05);
        }

        .picture-card.matched {
            background: linear-gradient(45deg, #00cec9, #55efc4);
            animation: bounce 0.6s ease;
        }

        .listen-repeat {
            background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
            color: white;
        }

        .record-btn {
            background: #e17055;
            color: white;
            border: none;
            padding: 20px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 80px;
            height: 80px;
        }

        .record-btn:hover {
            transform: scale(1.1);
        }

        .record-btn.recording {
            animation: pulse 1s infinite;
            background: #d63031;
        }

        .progress-dashboard {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            color: white;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .feedback-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #feca57;
            animation: confettiFall 3s linear infinite;
        }

        .success-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #00cec9, #55efc4);
            color: white;
            padding: 30px 50px;
            border-radius: 25px;
            font-size: 2em;
            font-weight: bold;
            z-index: 1001;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: successPop 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translateY(0); }
            40%, 43% { transform: translateY(-10px); }
            70% { transform: translateY(-5px); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }

        @keyframes successPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .navigation {
                flex-wrap: wrap;
            }
            
            .nav-btn {
                font-size: 14px;
                padding: 10px 16px;
            }
            
            .story-illustration {
                width: 250px;
                height: 160px;
                font-size: 3em;
            }
            
            .picture-matching {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <h1>üìö Interactive Storybook</h1>
            <p>Belajar sambil bermain untuk anak usia 4-7 tahun</p>
            <nav class="navigation">
                <button class="nav-btn active" onclick="showSection('story')">üìñ Cerita</button>
                <button class="nav-btn" onclick="showSection('interactive')">üéÆ Interaktif</button>
                <button class="nav-btn" onclick="showSection('games')">üéØ Mini Game</button>
                <button class="nav-btn" onclick="showSection('listen')">üé§ Dengar & Ulangi</button>
                <button class="nav-btn" onclick="showSection('progress')">üìä Progress</button>
            </nav>
        </header>

        <main class="main-content">
            <!-- Story Section -->
            <section id="story-section" class="story-section active">
                <div class="storybook">
                    <div class="story-header">
                        <h2 class="story-title">Petualangan Kucing Kecil</h2>
                    </div>
                    
                    <div class="story-illustration">
                        üê±
                    </div>
                    
                    <div class="story-text" id="story-text">
                        Ada seekor kucing kecil bernama Mimi yang suka bermain di taman. 
                        Hari ini Mimi ingin mencari teman baru untuk bermain bersama.
                        Mimi berjalan ke taman dan bertemu dengan seekor anjing yang ramah.
                    </div>
                    
                    <div class="audio-controls">
                        <button class="audio-btn" onclick="playStoryAudio()">üîä Putar Cerita</button>
                        <button class="audio-btn" onclick="pauseStoryAudio()">‚è∏Ô∏è Pause</button>
                    </div>
                </div>
            </section>

            <!-- Interactive Section -->
            <section id="interactive-section" class="story-section">
                <div class="interactive-section">
                    <h2>üéØ Lengkapi Kalimat</h2>
                    <div class="drag-drop-area">
                        <div class="sentence-template">
                            Kucing kecil <span class="word-blank" data-answer="bermain"></span> di taman bersama <span class="word-blank" data-answer="anjing"></span> yang ramah.
                        </div>
                        
                        <div class="word-options">
                            <div class="draggable-word" draggable="true">bermain</div>
                            <div class="draggable-word" draggable="true">anjing</div>
                            <div class="draggable-word" draggable="true">makan</div>
                            <div class="draggable-word" draggable="true">kucing</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="audio-btn" onclick="checkAnswers()">‚úì Periksa Jawaban</button>
                    </div>
                </div>
            </section>

            <!-- Mini Games Section -->
            <section id="games-section" class="story-section">
                <div class="mini-game">
                    <h2 class="game-title">üéÆ Cocokkan Gambar & Kata</h2>
                    <p>Klik gambar yang sesuai dengan kata!</p>
                    
                    <div style="margin: 20px 0; font-size: 1.5em; font-weight: bold;">
                        Kata: <span id="current-word">KUCING</span>
                    </div>
                    
                    <div class="picture-matching">
                        <div class="picture-card" onclick="selectPicture(this, 'kucing')">üê±</div>
                        <div class="picture-card" onclick="selectPicture(this, 'anjing')">üê∂</div>
                        <div class="picture-card" onclick="selectPicture(this, 'taman')">üå≥</div>
                        <div class="picture-card" onclick="selectPicture(this, 'bermain')">‚öΩ</div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <p>Skor: <span id="game-score">0</span> / 4</p>
                    </div>
                </div>
            </section>

            <!-- Listen & Repeat Section -->
            <section id="listen-section" class="story-section">
                <div class="listen-repeat">
                    <h2>üé§ Dengarkan & Ulangi</h2>
                    <p>Dengarkan kata berikut, lalu ulangi dengan suara Anda!</p>
                    
                    <div style="margin: 30px 0;">
                        <div style="font-size: 2em; margin-bottom: 20px;">
                            Kata: <strong id="practice-word">BERMAIN</strong>
                        </div>
                        
                        <button class="audio-btn" onclick="playPracticeWord()">üîä Dengar Kata</button>
                    </div>
                    
                    <div>
                        <button class="record-btn" onclick="toggleRecording()" id="record-btn">üé§</button>
                        <p>Tekan untuk merekam suara Anda</p>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="audio-btn" onclick="playRecording()" id="play-recording" style="display: none;">‚ñ∂Ô∏è Putar Rekaman</button>
                    </div>
                </div>
            </section>

            <!-- Progress Section -->
            <section id="progress-section" class="story-section">
                <div class="progress-dashboard">
                    <h2>üìä Dashboard Progress</h2>
                    <p>Pantau kemajuan belajar anak Anda</p>
                    
                    <div class="progress-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="words-learned">12</div>
                            <div>Kata Baru Dikuasai</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="stories-completed">3</div>
                            <div>Cerita Selesai</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="games-played">8</div>
                            <div>Game Dimainkan</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="accuracy-rate">85%</div>
                            <div>Tingkat Akurasi</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <h3>üèÜ Pencapaian Terbaru</h3>
                        <div style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; margin-top: 15px;">
                            <p>üåü Menyelesaikan cerita "Petualangan Kucing Kecil"</p>
                            <p>üéØ Mencapai 85% akurasi dalam mini game</p>
                            <p>üé§ Berhasil merekam 5 kata dengan jelas</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Feedback Animation Container -->
    <div class="feedback-animation" id="feedback-container"></div>

    <script>
        // Global variables
        let currentSection = 'story';
        let gameScore = 0;
        let totalQuestions = 4;
        let gameWords = ['kucing', 'anjing', 'taman', 'bermain'];
        let currentWordIndex = 0;
        let isRecording = false;
        let mediaRecorder;
        let recordedChunks = [];
        let progressData = {
            wordsLearned: 12,
            storiesCompleted: 3,
            gamesPlayed: 8,
            accuracyRate: 85
        };

        // Section Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.story-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            currentSection = sectionName;
        }

        // Story Audio Functions
        function playStoryAudio() {
            const storyText = document.getElementById('story-text').textContent;
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(storyText);
                utterance.lang = 'id-ID';
                utterance.rate = 0.8;
                utterance.pitch = 1.2;
                speechSynthesis.speak(utterance);
            } else {
                alert('Browser Anda tidak mendukung text-to-speech');
            }
        }

        function pauseStoryAudio() {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
            }
        }

        // Drag and Drop Functionality
        function initializeDragAndDrop() {
            const draggableWords = document.querySelectorAll('.draggable-word');
            const wordBlanks = document.querySelectorAll('.word-blank');

            draggableWords.forEach(word => {
                word.addEventListener('dragstart', handleDragStart);
                word.addEventListener('dragend', handleDragEnd);
            });

            wordBlanks.forEach(blank => {
                blank.addEventListener('dragover', handleDragOver);
                blank.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.textContent);
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            const draggedText = e.dataTransfer.getData('text/plain');
            if (e.target.classList.contains('word-blank')) {
                e.target.textContent = draggedText;
                e.target.style.background = 'rgba(85, 239, 196, 0.8)';
            }
        }

        // Check Answers Function
        function checkAnswers() {
            const blanks = document.querySelectorAll('.word-blank');
            let correctAnswers = 0;
            
            blanks.forEach(blank => {
                const userAnswer = blank.textContent.toLowerCase().trim();
                const correctAnswer = blank.dataset.answer.toLowerCase();
                
                if (userAnswer === correctAnswer) {
                    blank.style.background = 'rgba(85, 239, 196, 0.8)';
                    correctAnswers++;
                } else {
                    blank.style.background = 'rgba(255, 107, 107, 0.8)';
                }
            });
            
            if (correctAnswers === blanks.length) {
                showSuccessMessage('Hebat! Semua jawaban benar!');
                createConfetti();
                updateProgress('accuracy');
            } else {
                showSuccessMessage(`Bagus! ${correctAnswers} dari ${blanks.length} jawaban benar. Coba lagi!`);
            }
        }

        // Mini Game Functions
        function selectPicture(element, answer) {
            const currentWord = gameWords[currentWordIndex].toLowerCase();
            
            if (answer.toLowerCase() === currentWord) {
                element.classList.add('matched');
                gameScore++;
                document.getElementById('game-score').textContent = gameScore;
                
                playCorrectSound();
                
                setTimeout(() => {
                    nextGameWord();
                }, 1000);
                
                if (gameScore === totalQuestions) {
                    setTimeout(() => {
                        showSuccessMessage('üéâ Selamat! Anda menyelesaikan semua soal!');
                        createConfetti();
                        updateProgress('games');
                        resetGame();
                    }, 1500);
                }
            } else {
                element.style.background = 'rgba(255, 107, 107, 0.8)';
                setTimeout(() => {
                    element.style.background = 'white';
                }, 1000);
            }
        }

        function nextGameWord() {
            currentWordIndex = (currentWordIndex + 1) % gameWords.length;
            const wordDisplay = document.getElementById('current-word');
            wordDisplay.textContent = gameWords[currentWordIndex].toUpperCase();
            
            // Reset card colors
            document.querySelectorAll('.picture-card').forEach(card => {
                card.classList.remove('matched');
                card.style.background = 'white';
            });
        }

        function resetGame() {
            gameScore = 0;
            currentWordIndex = 0;
            document.getElementById('game-score').textContent = '0';
            document.getElementById('current-word').textContent = gameWords[0].toUpperCase();
            
            document.querySelectorAll('.picture-card').forEach(card => {
                card.classList.remove('matched');
                card.style.background = 'white';
            });
        }

        // Listen & Repeat Functions
        function playPracticeWord() {
            const word = document.getElementById('practice-word').textContent;
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'id-ID';
                utterance.rate = 0.7;
                utterance.pitch = 1.3;
                speechSynthesis.speak(utterance);
            }
        }

        async function toggleRecording() {
            const recordBtn = document.getElementById('record-btn');
            
            if (!isRecording) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    recordedChunks = [];
                    
                    mediaRecorder.addEventListener('dataavailable', event => {
                        if (event.data.size > 0) {
                            recordedChunks.push(event.data);
                        }
                    });
                    
                    mediaRecorder.addEventListener('stop', () => {
                        const blob = new Blob(recordedChunks, { type: 'audio/wav' });
                        const audioUrl = URL.createObjectURL(blob);
                        
                        const playButton = document.getElementById('play-recording');
                        playButton.style.display = 'inline-block';
                        playButton.onclick = () => {
                            const audio = new Audio(audioUrl);
                            audio.play();
                        };
                    });
                    
                    mediaRecorder.start();
                    isRecording = true;
                    recordBtn.classList.add('recording');
                    recordBtn.innerHTML = '‚èπÔ∏è';
                    
                } catch (error) {
                    console.error('Error accessing microphone:', error);
                    alert('Tidak dapat mengakses mikrofon. Pastikan Anda memberikan izin akses mikrofon.');
                }
            } else {
                mediaRecorder.stop();
                isRecording = false;
                recordBtn.classList.remove('recording');
                recordBtn.innerHTML = 'üé§';
                
                // Stop all tracks
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                
                showSuccessMessage('Rekaman selesai! Anda bisa memutar rekaman Anda.');
                updateProgress('words');
            }
        }

        function playRecording() {
            // This function is dynamically created in toggleRecording
        }

        // Feedback Functions
        function showSuccessMessage(message) {
            const messageEl = document.createElement('div');
            messageEl.className = 'success-message';
            messageEl.textContent = message;
            document.body.appendChild(messageEl);
            
            playCorrectSound();
            
            setTimeout(() => {
                messageEl.remove();
            }, 3000);
        }

        function createConfetti() {
            const container = document.getElementById('feedback-container');
            const colors = ['#feca57', '#ff6b6b', '#48dbfb', '#ff9ff3', '#54a0ff', '#5f27cd'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                container.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        function playCorrectSound() {
            // Create audio context for sound effects
            if ('AudioContext' in window || 'webkitAudioContext' in window) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const audioContext = new AudioContext();
                
                // Create a simple success sound
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            }
        }

        // Progress Update Functions
        function updateProgress(type) {
            switch(type) {
                case 'words':
                    progressData.wordsLearned++;
                    document.getElementById('words-learned').textContent = progressData.wordsLearned;
                    break;
                case 'games':
                    progressData.gamesPlayed++;
                    document.getElementById('games-played').textContent = progressData.gamesPlayed;
                    break;
                case 'accuracy':
                    progressData.accuracyRate = Math.min(100, progressData.accuracyRate + 1);
                    document.getElementById('accuracy-rate').textContent = progressData.accuracyRate + '%';
                    break;
                case 'stories':
                    progressData.storiesCompleted++;
                    document.getElementById('stories-completed').textContent = progressData.storiesCompleted;
                    break;
            }
            
            // Save progress to memory (in a real app, this would be saved to a database)
            saveProgress();
        }

        function saveProgress() {
            // In a real application, this would save to a backend
            // For now, we'll just store in a variable
            console.log('Progress saved:', progressData);
        }

        // Story Management
        const stories = [
            {
                title: "Petualangan Kucing Kecil",
                illustration: "üê±",
                text: "Ada seekor kucing kecil bernama Mimi yang suka bermain di taman. Hari ini Mimi ingin mencari teman baru untuk bermain bersama. Mimi berjalan ke taman dan bertemu dengan seekor anjing yang ramah.",
                words: ["kucing", "bermain", "taman", "anjing"],
                questions: [
                    { blank: "bermain", options: ["bermain", "makan", "tidur", "lari"] },
                    { blank: "anjing", options: ["anjing", "kucing", "burung", "ikan"] }
                ]
            },
            {
                title: "Petualangan di Hutan",
                illustration: "üå≥",
                text: "Seorang anak bernama Budi pergi ke hutan bersama ayahnya. Mereka melihat banyak pohon tinggi dan mendengar suara burung berkicau. Budi sangat senang bisa menjelajahi hutan yang indah.",
                words: ["hutan", "pohon", "burung", "senang"],
                questions: [
                    { blank: "hutan", options: ["hutan", "pantai", "gunung", "sungai"] },
                    { blank: "burung", options: ["burung", "ikan", "kupu-kupu", "semut"] }
                ]
            }
        ];

        let currentStoryIndex = 0;

        function loadStory(index) {
            const story = stories[index];
            document.querySelector('.story-title').textContent = story.title;
            document.querySelector('.story-illustration').textContent = story.illustration;
            document.querySelector('.story-text').textContent = story.text;
            
            // Update interactive section
            updateInteractiveSection(story);
            
            // Update mini game
            gameWords = story.words;
            resetGame();
        }

        function updateInteractiveSection(story) {
            const template = document.querySelector('.sentence-template');
            const wordOptions = document.querySelector('.word-options');
            
            // Create sentence with blanks
            let sentence = story.text.split('.')[0]; // Take first sentence
            story.questions.forEach(q => {
                sentence = sentence.replace(q.blank, `<span class="word-blank" data-answer="${q.blank}"></span>`);
            });
            
            template.innerHTML = sentence;
            
            // Create word options
            wordOptions.innerHTML = '';
            const allOptions = [];
            story.questions.forEach(q => {
                allOptions.push(...q.options);
            });
            
            // Remove duplicates and shuffle
            const uniqueOptions = [...new Set(allOptions)];
            shuffleArray(uniqueOptions);
            
            uniqueOptions.forEach(option => {
                const wordEl = document.createElement('div');
                wordEl.className = 'draggable-word';
                wordEl.draggable = true;
                wordEl.textContent = option;
                wordOptions.appendChild(wordEl);
            });
            
            // Reinitialize drag and drop
            initializeDragAndDrop();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function nextStory() {
            currentStoryIndex = (currentStoryIndex + 1) % stories.length;
            loadStory(currentStoryIndex);
            updateProgress('stories');
            showSuccessMessage('Cerita baru dimuat! üìö');
        }

        function previousStory() {
            currentStoryIndex = currentStoryIndex === 0 ? stories.length - 1 : currentStoryIndex - 1;
            loadStory(currentStoryIndex);
        }

        // Vocabulary Practice
        const vocabularyWords = [
            "BERMAIN", "KUCING", "ANJING", "TAMAN", "SENANG",
            "HUTAN", "POHON", "BURUNG", "ANAK", "AYAH"
        ];

        let currentVocabIndex = 0;

        function nextVocabularyWord() {
            currentVocabIndex = (currentVocabIndex + 1) % vocabularyWords.length;
            document.getElementById('practice-word').textContent = vocabularyWords[currentVocabIndex];
        }

        function previousVocabularyWord() {
            currentVocabIndex = currentVocabIndex === 0 ? vocabularyWords.length - 1 : currentVocabIndex - 1;
            document.getElementById('practice-word').textContent = vocabularyWords[currentVocabIndex];
        }

        // Difficulty Levels
        let currentDifficulty = 'easy';
        const difficultySettings = {
            easy: { wordCount: 4, timeLimit: null, hints: true },
            medium: { wordCount: 6, timeLimit: 60, hints: true },
            hard: { wordCount: 8, timeLimit: 45, hints: false }
        };

        function changeDifficulty(level) {
            currentDifficulty = level;
            const settings = difficultySettings[level];
            
            // Update game based on difficulty
            totalQuestions = settings.wordCount;
            
            // Show difficulty indicator
            showSuccessMessage(`Tingkat kesulitan: ${level.toUpperCase()}`);
        }

        // Add navigation controls to story section
        function addStoryNavigation() {
            const storySection = document.querySelector('.storybook');
            const navControls = document.createElement('div');
            navControls.style.textAlign = 'center';
            navControls.style.marginTop = '20px';
            navControls.innerHTML = `
                <button class="audio-btn" onclick="previousStory()">‚¨ÖÔ∏è Cerita Sebelumnya</button>
                <button class="audio-btn" onclick="nextStory()">Cerita Selanjutnya ‚û°Ô∏è</button>
            `;
            storySection.appendChild(navControls);
        }

        // Add vocabulary navigation to listen section
        function addVocabularyNavigation() {
            const listenSection = document.querySelector('.listen-repeat');
            const vocabNav = document.createElement('div');
            vocabNav.style.textAlign = 'center';
            vocabNav.style.marginTop = '20px';
            vocabNav.innerHTML = `
                <button class="audio-btn" onclick="previousVocabularyWord()">‚¨ÖÔ∏è Kata Sebelumnya</button>
                <button class="audio-btn" onclick="nextVocabularyWord()">Kata Selanjutnya ‚û°Ô∏è</button>
            `;
            listenSection.appendChild(vocabNav);
        }

        // Add difficulty selector to games section
        function addDifficultySelector() {
            const gamesSection = document.querySelector('.mini-game');
            const difficultySelector = document.createElement('div');
            difficultySelector.style.textAlign = 'center';
            difficultySelector.style.marginBottom = '20px';
            difficultySelector.innerHTML = `
                <h3>Pilih Tingkat Kesulitan:</h3>
                <div style="margin-top: 10px;">
                    <button class="audio-btn" onclick="changeDifficulty('easy')" style="margin: 5px;">üòä Mudah</button>
                    <button class="audio-btn" onclick="changeDifficulty('medium')" style="margin: 5px;">üòê Sedang</button>
                    <button class="audio-btn" onclick="changeDifficulty('hard')" style="margin: 5px;">üò§ Sulit</button>
                </div>
            `;
            gamesSection.insertBefore(difficultySelector, gamesSection.querySelector('.picture-matching'));
        }

        // Initialize app
        function initializeApp() {
            loadStory(0);
            initializeDragAndDrop();
            addStoryNavigation();
            addVocabularyNavigation();
            addDifficultySelector();
            
            // Load initial progress
            document.getElementById('words-learned').textContent = progressData.wordsLearned;
            document.getElementById('stories-completed').textContent = progressData.storiesCompleted;
            document.getElementById('games-played').textContent = progressData.gamesPlayed;
            document.getElementById('accuracy-rate').textContent = progressData.accuracyRate + '%';
            
            console.log('Interactive Storybook initialized successfully!');
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        showSection('story');
                        break;
                    case '2':
                        e.preventDefault();
                        showSection('interactive');
                        break;
                    case '3':
                        e.preventDefault();
                        showSection('games');
                        break;
                    case '4':
                        e.preventDefault();
                        showSection('listen');
                        break;
                    case '5':
                        e.preventDefault();
                        showSection('progress');
                        break;
                }
            }
            
            if (e.key === 'Space' && currentSection === 'story') {
                e.preventDefault();
                playStoryAudio();
            }
        });

        // Touch support for mobile devices
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // Swipe left - next story/word
                    if (currentSection === 'story') {
                        nextStory();
                    } else if (currentSection === 'listen') {
                        nextVocabularyWord();
                    }
                } else {
                    // Swipe right - previous story/word
                    if (currentSection === 'story') {
                        previousStory();
                    } else if (currentSection === 'listen') {
                        previousVocabularyWord();
                    }
                }
            }
        }

        // Accessibility improvements
        function addAccessibilityFeatures() {
            // Add ARIA labels
            document.querySelectorAll('.nav-btn').forEach((btn, index) => {
                btn.setAttribute('aria-label', `Navigate to ${btn.textContent}`);
                btn.setAttribute('tabindex', '0');
            });
            
            // Add keyboard navigation for drag and drop
            document.querySelectorAll('.draggable-word').forEach(word => {
                word.setAttribute('tabindex', '0');
                word.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        // Find first empty blank and fill it
                        const emptyBlank = document.querySelector('.word-blank:not([data-filled])');
                        if (emptyBlank) {
                            emptyBlank.textContent = word.textContent;
                            emptyBlank.style.background = 'rgba(85, 239, 196, 0.8)';
                            emptyBlank.setAttribute('data-filled', 'true');
                        }
                    }
                });
            });
        }

        // Performance optimization
        function optimizePerformance() {
            // Lazy load animations
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animationPlayState = 'running';
                    }
                });
            });
            
            document.querySelectorAll('.story-illustration').forEach(el => {
                observer.observe(el);
            });
        }

        // Add final initialization
        document.addEventListener('DOMContentLoaded', () => {
            addAccessibilityFeatures();
            optimizePerformance();
        });
    </script>
</body>
</html>